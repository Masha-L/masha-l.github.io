<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% if page.title %}{{ page.title }} | {% endif %}{{ site.title }}</title>
  <meta name="description" content="{{ page.description | default: site.description }}">
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Crimson+Pro:ital,wght@0,400;0,500;1,400&display=swap" rel="stylesheet">
  <!-- Styles -->
  <link rel="stylesheet" href="{{ '/assets/css/style.css' | relative_url }}">
  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚ú®</text></svg>">
  {% feed_meta %}
  {% seo %}
</head>
<body>
  <nav class="nav">
    <div class="nav-container">
      <a href="{{ '/' | relative_url }}" class="nav-logo">ML</a>
      <div class="nav-links">
        <a href="{{ '/' | relative_url }}" {% if page.url == '/' %}class="active"{% endif %}>Home</a>
        <a href="{{ '/about/' | relative_url }}" {% if page.url == '/about/' %}class="active"{% endif %}>About</a>
        <a href="{{ '/work/' | relative_url }}" {% if page.url == '/work/' %}class="active"{% endif %}>Work</a>
        <a href="{{ '/projects/' | relative_url }}" {% if page.url == '/projects/' %}class="active"{% endif %}>Projects</a>
        <a href="{{ '/blog/' | relative_url }}" {% if page.url contains '/blog' %}class="active"{% endif %}>Writing</a>
        <button class="theme-toggle" aria-label="Toggle dark mode" title="Toggle dark mode">üåô</button>
      </div>
      <button class="nav-toggle" aria-label="Toggle menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </nav>
  <main class="main">
    {{ content }}
  </main>
  <footer class="footer">
    <div class="footer-container">
      <div class="footer-content">
        <p class="footer-tagline">Building things that matter, one line at a time.</p>
        <div class="footer-links">
          <a href="{{ '/now/' | relative_url }}">Now</a>
          <a href="{{ '/uses/' | relative_url }}">Uses</a>
          <a href="{{ '/running/' | relative_url }}">Running</a>
          <a href="https://twitter.com/ocean_ragess" target="_blank" rel="noopener">Twitter</a>
          <a href="https://github.com/Masha-L" target="_blank" rel="noopener">GitHub</a>
        </div>
      </div>
      <p class="footer-copy">¬© {{ 'now' | date: "%Y" }} Masha Lifshits ¬∑ Built with Jekyll, hosted on GitHub Pages, designed with <a href="https://github.com/Masha-L/masha-l.github.io" style="color: inherit; text-decoration: underline;">curiosity</a></p>
    </div>
  </footer>
  <script>
    // Dark mode toggle
    const themeToggle = document.querySelector('.theme-toggle');
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    const savedTheme = localStorage.getItem('theme');
    
    function setTheme(theme) {
      document.documentElement.setAttribute('data-theme', theme);
      localStorage.setItem('theme', theme);
      themeToggle.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
    }
    
    // Initialize theme
    if (savedTheme) {
      setTheme(savedTheme);
    } else if (prefersDark) {
      setTheme('dark');
    }
    
    themeToggle.addEventListener('click', () => {
      const current = document.documentElement.getAttribute('data-theme');
      setTheme(current === 'dark' ? 'light' : 'dark');
    });

    // Mobile nav toggle
    const toggle = document.querySelector('.nav-toggle');
    const nav = document.querySelector('.nav');
    toggle.addEventListener('click', () => nav.classList.toggle('nav-open'));
    
    // Intersection observer for fade-in animations
    const observerOptions = { threshold: 0.1, rootMargin: '0px 0px -50px 0px' };
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
        }
      });
    }, observerOptions);
    document.querySelectorAll('.fade-in').forEach(el => observer.observe(el));

    // Quote rotator
    const rotator = document.getElementById('quote-rotator');
    const dotsContainer = document.getElementById('quote-dots');
    if (rotator && dotsContainer) {
      const quotes = rotator.querySelectorAll('.quote-item');
      let currentQuote = 0;
      
      // Create dots
      quotes.forEach((_, i) => {
        const dot = document.createElement('button');
        dot.className = 'quote-dot' + (i === 0 ? ' active' : '');
        dot.addEventListener('click', () => goToQuote(i));
        dotsContainer.appendChild(dot);
      });
      
      const dots = dotsContainer.querySelectorAll('.quote-dot');
      
      function goToQuote(index) {
        quotes[currentQuote].classList.remove('active');
        dots[currentQuote].classList.remove('active');
        currentQuote = index;
        quotes[currentQuote].classList.add('active');
        dots[currentQuote].classList.add('active');
      }
      
      setInterval(() => {
        goToQuote((currentQuote + 1) % quotes.length);
      }, 4000);
    }

    // Scroll reveal
    const revealObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
        }
      });
    }, { threshold: 0.1 });
    document.querySelectorAll('.card, .team-card, .featured-card, .interest-card, .now-item').forEach(el => {
      el.classList.add('reveal');
      revealObserver.observe(el);
    });

    // Smooth parallax effect with requestAnimationFrame
    const heroContent = document.querySelector('.hero-content');
    const shapes = {
      s1: document.querySelectorAll('.shape-1'),
      s2: document.querySelectorAll('.shape-2'),
      s3: document.querySelectorAll('.shape-3'),
      s4: document.querySelectorAll('.shape-4'),
      s5: document.querySelectorAll('.shape-5')
    };
    
    let ticking = false;
    let lastScrollY = 0;
    let currentY = 0;
    
    function lerp(start, end, factor) {
      return start + (end - start) * factor;
    }
    
    function updateParallax() {
      // Smooth interpolation for buttery scrolling
      currentY = lerp(currentY, lastScrollY, 0.1);
      
      const scrolled = currentY;
      
      // Move shapes at different speeds
      shapes.s1.forEach(el => {
        el.style.transform = `translate3d(0, ${scrolled * -0.3}px, 0) rotate(${scrolled * 0.02}deg)`;
      });
      shapes.s2.forEach(el => {
        el.style.transform = `translate3d(0, ${scrolled * -0.15}px, 0) rotate(${scrolled * -0.03}deg)`;
      });
      shapes.s3.forEach(el => {
        el.style.transform = `translate3d(0, ${scrolled * -0.5}px, 0) rotate(${scrolled * 0.01}deg)`;
      });
      shapes.s4.forEach(el => {
        el.style.transform = `translate3d(0, ${scrolled * -0.4}px, 0) rotate(${scrolled * -0.02}deg)`;
      });
      shapes.s5.forEach(el => {
        el.style.transform = `translate3d(0, ${scrolled * -0.25}px, 0) rotate(${scrolled * 0.015}deg)`;
      });
      
      // Hero content
      if (heroContent && scrolled < 800) {
        heroContent.style.transform = `translate3d(0, ${scrolled * 0.2}px, 0)`;
        heroContent.style.opacity = Math.max(0, 1 - (scrolled * 0.0015));
      }
      
      // Parallax for all sections
      document.querySelectorAll('.section').forEach(section => {
        const rect = section.getBoundingClientRect();
        const inView = rect.top < window.innerHeight && rect.bottom > 0;
        
        if (inView) {
          const progress = (window.innerHeight - rect.top) / (window.innerHeight + rect.height);
          const offset = (progress - 0.5) * 30;
          
          const header = section.querySelector('.section-header');
          if (header) {
            header.style.transform = `translate3d(0, ${offset * -0.5}px, 0)`;
          }
          
          const cards = section.querySelectorAll('.card, .team-card, .featured-card, .interest-card, .now-item, .timeline-item');
          cards.forEach((card, i) => {
            const cardOffset = offset * (0.3 + (i % 3) * 0.1);
            card.style.transform = `translate3d(0, ${cardOffset}px, 0)`;
          });
        }
      });
      
      // Keep animating if not caught up
      if (Math.abs(currentY - lastScrollY) > 0.5) {
        requestAnimationFrame(updateParallax);
      } else {
        ticking = false;
      }
    }
    
    window.addEventListener('scroll', () => {
      lastScrollY = window.pageYOffset;
      if (!ticking) {
        ticking = true;
        requestAnimationFrame(updateParallax);
      }
    }, { passive: true });
    
    // Typing effect for hero
    const typingText = document.querySelector('.typing-text');
    if (typingText) {
      const phrases = [
        'less confusing',
        'actually work',
        'not lose your data',
        'scale globally',
        'spark joy'
      ];
      let phraseIndex = 0;
      let charIndex = 0;
      let isDeleting = false;
      let isPaused = false;
      
      function type() {
        const currentPhrase = phrases[phraseIndex];
        
        if (isPaused) {
          isPaused = false;
          isDeleting = true;
          setTimeout(type, 2000);
          return;
        }
        
        if (isDeleting) {
          typingText.textContent = currentPhrase.substring(0, charIndex - 1);
          charIndex--;
          
          if (charIndex === 0) {
            isDeleting = false;
            phraseIndex = (phraseIndex + 1) % phrases.length;
            setTimeout(type, 500);
            return;
          }
        } else {
          typingText.textContent = currentPhrase.substring(0, charIndex + 1);
          charIndex++;
          
          if (charIndex === currentPhrase.length) {
            isPaused = true;
            setTimeout(type, 100);
            return;
          }
        }
        
        setTimeout(type, isDeleting ? 80 : 120);
      }
      
      setTimeout(type, 1000);
    }

    // Easter egg: Konami code
    const konamiCode = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'];
    let konamiIndex = 0;
    document.addEventListener('keydown', (e) => {
      if (e.key === konamiCode[konamiIndex]) {
        konamiIndex++;
        if (konamiIndex === konamiCode.length) {
          document.body.style.fontFamily = 'Comic Sans MS, cursive';
          document.querySelectorAll('*').forEach(el => {
            el.style.transition = 'transform 0.5s ease';
            el.style.transform = `rotate(${Math.random() * 6 - 3}deg)`;
          });
          setTimeout(() => alert('üéÆ You found the easter egg! Refresh to restore sanity.'), 100);
          konamiIndex = 0;
        }
      } else {
        konamiIndex = 0;
      }
    });

    // 3D Tilt effect on cards
    document.querySelectorAll('.card, .interest-card, .now-item').forEach(card => {
      card.addEventListener('mousemove', (e) => {
        const rect = card.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        const centerX = rect.width / 2;
        const centerY = rect.height / 2;
        const rotateX = (y - centerY) / 10;
        const rotateY = (centerX - x) / 10;
        card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale3d(1.02, 1.02, 1.02)`;
      });
      card.addEventListener('mouseleave', () => {
        card.style.transform = 'perspective(1000px) rotateX(0) rotateY(0) scale3d(1, 1, 1)';
      });
    });

    // Secret terminal - type 'help' anywhere
    let secretBuffer = '';
    const secretCommands = {
      'help': 'üñ•Ô∏è Secret terminal! Try: whoami, skills, joke, matrix, coffee',
      'whoami': 'üë©‚Äçüíª Masha Lifshits ‚Äî Engineering Lead @ Google Cloud, Crypto Student @ NYU, Human Being',
      'skills': '‚ö° TypeScript, Go, Python, SQL, distributed systems, making databases less scary',
      'joke': 'üíæ Why do programmers prefer dark mode? Because light attracts bugs.',
      'matrix': null, // special handler
      'coffee': '‚òï *brewing sounds* Here you go! ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 100%',
      'ls': 'üìÅ about.md  work.md  projects.md  secrets/  .hidden-talents',
      'cd secrets': 'üîê Permission denied. Nice try though.',
      'sudo': 'üö´ Masha is not in the sudoers file. This incident will be reported.',
      'exit': 'üëã Goodbye! (just kidding, you can\'t escape)'
    };
    
    document.addEventListener('keypress', (e) => {
      if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
      secretBuffer += e.key.toLowerCase();
      if (secretBuffer.length > 20) secretBuffer = secretBuffer.slice(-20);
      
      for (const [cmd, response] of Object.entries(secretCommands)) {
        if (secretBuffer.endsWith(cmd)) {
          if (cmd === 'matrix') {
            document.body.style.background = '#000';
            document.body.style.color = '#0f0';
            document.querySelectorAll('*').forEach(el => el.style.color = '#0f0');
            setTimeout(() => alert('üü¢ Wake up, Neo...'), 500);
          } else {
            // Create floating notification
            const notif = document.createElement('div');
            notif.style.cssText = `
              position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
              background: var(--color-bg-alt, #1a1a2e); color: var(--color-text, #fff);
              padding: 1rem 2rem; border-radius: 12px; font-family: monospace;
              box-shadow: 0 10px 40px rgba(0,0,0,0.3); z-index: 10000;
              animation: slideUp 0.3s ease, fadeOut 0.3s ease 3s forwards;
              border: 1px solid var(--color-primary, #6c63ff);
            `;
            notif.textContent = response;
            document.body.appendChild(notif);
            setTimeout(() => notif.remove(), 3500);
          }
          secretBuffer = '';
          break;
        }
      }
    });

    // Mobile Easter Egg: Shake for confetti
    let shakeThreshold = 15;
    let lastX, lastY, lastZ;
    let shakeCount = 0;
    
    if (window.DeviceMotionEvent) {
      window.addEventListener('devicemotion', (e) => {
        const acc = e.accelerationIncludingGravity;
        if (!acc.x) return;
        
        if (lastX !== undefined) {
          const deltaX = Math.abs(acc.x - lastX);
          const deltaY = Math.abs(acc.y - lastY);
          const deltaZ = Math.abs(acc.z - lastZ);
          
          if (deltaX + deltaY + deltaZ > shakeThreshold) {
            shakeCount++;
            if (shakeCount > 3) {
              triggerConfetti();
              shakeCount = 0;
            }
          }
        }
        lastX = acc.x; lastY = acc.y; lastZ = acc.z;
      });
    }
    
    function triggerConfetti() {
      const colors = ['#6c63ff', '#ff6b6b', '#4ecdc4', '#ffe66d', '#95e1d3'];
      for (let i = 0; i < 100; i++) {
        const confetti = document.createElement('div');
        confetti.style.cssText = `
          position: fixed;
          width: ${Math.random() * 10 + 5}px;
          height: ${Math.random() * 10 + 5}px;
          background: ${colors[Math.floor(Math.random() * colors.length)]};
          left: ${Math.random() * 100}vw;
          top: -20px;
          border-radius: ${Math.random() > 0.5 ? '50%' : '0'};
          pointer-events: none;
          z-index: 10001;
          animation: confettiFall ${Math.random() * 2 + 2}s linear forwards;
        `;
        document.body.appendChild(confetti);
        setTimeout(() => confetti.remove(), 4000);
      }
    }
    
    // Mobile Easter Egg: Landscape secret message
    let landscapeMessageShown = false;
    function checkOrientation() {
      const isLandscape = window.innerWidth > window.innerHeight && window.innerWidth < 1024;
      const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
      
      if (isLandscape && isMobile && !landscapeMessageShown) {
        landscapeMessageShown = true;
        const secret = document.createElement('div');
        secret.style.cssText = `
          position: fixed; top: 0; left: 0; right: 0; bottom: 0;
          background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
          display: flex; align-items: center; justify-content: center;
          flex-direction: column; z-index: 10002; color: #fff;
          font-family: var(--font-heading); text-align: center; padding: 2rem;
        `;
        secret.innerHTML = `
          <div style="font-size: 4rem; margin-bottom: 1rem;">üç™</div>
          <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">You rotated your phone for this?</div>
          <div style="font-size: 1rem; opacity: 0.7;">Here's a cookie. You've earned it.</div>
          <div style="font-size: 0.8rem; opacity: 0.5; margin-top: 2rem;">Rotate back to continue...</div>
        `;
        secret.id = 'landscape-secret';
        document.body.appendChild(secret);
      } else if (!isLandscape) {
        const existing = document.getElementById('landscape-secret');
        if (existing) existing.remove();
      }
    }
    
    window.addEventListener('resize', checkOrientation);
    window.addEventListener('orientationchange', checkOrientation);
    checkOrientation();

    // Mobile Easter Egg: Over-pull secret
    let pullStartY = 0;
    let isPulling = false;
    let overPullTriggered = false;
    
    // Create the hidden message element
    const overPullMsg = document.createElement('div');
    overPullMsg.style.cssText = `
      position: fixed; top: -80px; left: 0; right: 0;
      background: linear-gradient(135deg, #6c63ff, #4ecdc4);
      color: white; text-align: center; padding: 1.5rem;
      font-family: var(--font-heading); font-size: 0.95rem;
      z-index: 9999; transition: transform 0.3s ease;
      display: flex; align-items: center; justify-content: center; gap: 0.5rem;
    `;
    overPullMsg.innerHTML = '‚ú® You found the secret! You must really like pulling things. ‚ú®';
    document.body.appendChild(overPullMsg);
    
    document.addEventListener('touchstart', (e) => {
      if (window.scrollY === 0) {
        pullStartY = e.touches[0].clientY;
        isPulling = true;
      }
    }, { passive: true });
    
    document.addEventListener('touchmove', (e) => {
      if (!isPulling || overPullTriggered) return;
      const pullDistance = e.touches[0].clientY - pullStartY;
      
      if (pullDistance > 0 && window.scrollY === 0) {
        const progress = Math.min(pullDistance / 150, 1);
        overPullMsg.style.transform = `translateY(${progress * 80}px)`;
        
        if (pullDistance > 150) {
          overPullTriggered = true;
          overPullMsg.style.transform = 'translateY(80px)';
          setTimeout(() => {
            overPullMsg.style.transform = 'translateY(0)';
            setTimeout(() => { overPullTriggered = false; }, 1000);
          }, 2000);
        }
      }
    }, { passive: true });
    
    document.addEventListener('touchend', () => {
      isPulling = false;
      if (!overPullTriggered) {
        overPullMsg.style.transform = 'translateY(0)';
      }
    }, { passive: true });

    // Add CSS for terminal animations
    const terminalStyle = document.createElement('style');
    terminalStyle.textContent = `
      @keyframes confettiFall {
        0% { transform: translateY(0) rotate(0deg); opacity: 1; }
        100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
      }
      @keyframes slideUp {
        from { transform: translateX(-50%) translateY(20px); opacity: 0; }
        to { transform: translateX(-50%) translateY(0); opacity: 1; }
      }
      @keyframes fadeOut {
        to { opacity: 0; transform: translateX(-50%) translateY(-10px); }
      }
      .card, .interest-card, .now-item {
        transition: transform 0.15s ease-out, box-shadow 0.15s ease-out;
      }
      .card:hover, .interest-card:hover, .now-item:hover {
        box-shadow: 0 20px 40px rgba(0,0,0,0.15);
      }
      .btn {
        transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.2s ease;
      }
      .btn:hover {
        transform: translateY(-2px);
      }
      .btn:active {
        transform: translateY(0) scale(0.98);
      }
      .nav-logo:hover {
        animation: wiggle 0.5s ease;
      }
      @keyframes wiggle {
        0%, 100% { transform: rotate(0); }
        25% { transform: rotate(-5deg); }
        75% { transform: rotate(5deg); }
      }
      .card-icon, .now-icon, .interest-icon {
        transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      }
      .card:hover .card-icon, .now-item:hover .now-icon, .interest-card:hover .interest-icon {
        transform: scale(1.2) rotate(5deg);
      }
    `;
    document.head.appendChild(terminalStyle);
  </script>
</body>
</html>
